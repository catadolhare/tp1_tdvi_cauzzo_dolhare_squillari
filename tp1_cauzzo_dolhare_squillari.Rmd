---
title: "TP1"
author: "Catalina Dolhare, Camila Cauzzo, Renata Squillari"
date: "`r Sys.Date()`"
output:
  word_document: default
  pdf_document: default
---

**1. Introducción al problema**

El siguiente conjunto de datos presenta información acerca de una encuesta de satisfacción a pasageros de una cierta aerolinea. Obtuvimos este dataset de Kaggle, el cual cuenta con un conjunto de train con 104000 datos, representando el 80% del data set, y un conjunto de test con 26000 datos, representando el 20% del data set. Este data set cuenta con 23 variables, como "Type of travel", "Class", "Flight distance", "Departure Delay in Minutes", "Arrival Delay in Minutes". Principalmente, cuenta con "Satisfaction", variable categorica que puede tomar dos opciones: "Satisfaction" o "neutral or dissatisfaction".Con toda esta información, intentaremos predecir la satisfacción de un pasajero dado las respuesta a las variables.

-   Justificar la elección del conjunto de datos para el uso de árboles de decisión.

*2. Preparación de los datos*

```{r}
datos_train <- read.csv("train.csv")
datos_test <- read.csv("test.csv")
```

```{r}
datos<-rbind(datos_train, datos_test)
```

```{r}
set.seed(123)
sample_datos <- datos[sample(nrow(datos), 50000),]
nrow(sample_datos)
```

```{r}
sample_datos$satisfaction <- as.numeric(as.factor(sample_datos$satisfaction)) - 1
```

```{r}
summary(sample_datos)

```
A simple vista, vemos en la variable de satisfaction una mediana de 0 y una media 0.4338. Esto nos indica que hay mas pasajeros insatisfechos (0) que satisfechos (1).

```{r}
#install.packages("ggplot2")
library(ggplot2)
```

Para ver si las otras variables predictoras influyen en satisfacion hicimos una matriz de correlacion. Sabemos que correlacion no implica causalidad, no obstante, es bueno para visualizar y descartar variables que no influyen directamente en la satisfación de los pasajeros.
```{r, echo=FALSE}
#install.packages("corrplot")
library(corrplot)
numeric_data <- sample_datos[, sapply(sample_datos, is.numeric)]
cor_matrix <- cor(numeric_data)
corrplot(cor_matrix, method = "color", 
         tl.col = "black", tl.srt = 45, tl.cex = 0.5,  # Ajustes de etiquetas
         cl.ratio = 0.2,  # Ajustar el tamaño de las celdas
         addgrid.col = "black", # Añadir color a las líneas de la cuadrícula
         addCoef.col = "black",
         number.cex = 0.3)  
```
Se puede ver que hay algunas variables que no tienen correlación con la satisfación, y son "departure arrival time convenient", "gate of location", "departure delay in minutes", "departure arrival in minutes". Como no podemos descartar que no haya causalidad, analizamos estas variables para ver si inciden sobre la satisfación. 
```{r, echo=FALSE}
par(mfrow = c(1, 2), mar = c(5, 5, 4, 2), cex = 1.2)

# Filtrar los datos por nivel de satisfacción
delay_satisfecho <- sample_datos$Departure.Delay.in.Minutes[sample_datos$satisfaction == 1]
delay_insatisfecho <- sample_datos$Departure.Delay.in.Minutes[sample_datos$satisfaction == 0]

hist(delay_satisfecho, 
     probability = TRUE, 
     main = "Satisfechos", 
     xlab = "Departure Delay in Minutes", 
     xlim = c(0, max(sample_datos$Departure.Delay.in.Minutes, na.rm = TRUE)), 
     ylim = c(0, 0.04), 
     col = "red", 
     border = "black")

# Histograma para los clientes insatisfechos
hist(delay_insatisfecho, 
     probability = TRUE, 
     main = "Insatisfechos", 
     xlab = "Departure Delay in Minutes", 
     xlim = c(0, max(sample_datos$Departure.Delay.in.Minutes, na.rm = TRUE)), 
     ylim = c(0, 0.04), 
     col = "blue", 
     border = "black")
```

```{r, echo=FALSE}
par(mfrow = c(1, 2), mar = c(5, 5, 4, 2), cex = 1.2)

# Filtrar los datos por nivel de satisfacción
arrival_satisfecho <- sample_datos$Arrival.Delay.in.Minutes[sample_datos$satisfaction == 1]
arrival_insatisfecho <- sample_datos$Arrival.Delay.in.Minutes[sample_datos$satisfaction == 0]

hist(arrival_satisfecho, 
     probability = TRUE, 
     main = "Satisfechos", 
     xlab = "Arrival Delay in Minutes", 
     xlim = c(0, max(sample_datos$Arrival.Delay.in.Minutes, na.rm = TRUE)), 
     ylim = c(0, 0.04), 
     col = "red", 
     border = "black")

# Histograma para los clientes insatisfechos
hist(arrival_insatisfecho, 
     probability = TRUE, 
     main = "Insatisfechos", 
     xlab = "Arrival Delay in Minutes", 
     xlim = c(0, max(sample_datos$Arrival.Delay.in.Minutes, na.rm = TRUE)), 
     ylim = c(0, 0.04), 
     col = "blue", 
     border = "black")
```

```{r, echo=FALSE}
par(mfrow = c(1, 2), mar = c(5, 5, 4, 2), cex = 1.2)

# Filtrar los datos por nivel de satisfacción
departure_arrival_satisfecho <- sample_datos$Departure.Arrival.time.convenient[sample_datos$satisfaction == 1]
departure_arrival_insatisfecho <- sample_datos$Departure.Arrival.time.convenient[sample_datos$satisfaction == 0]

hist(departure_arrival_satisfecho, 
     probability = TRUE, 
     main = "Satisfechos", 
     xlab = "Departure arrival time convenient", 
     xlim = c(0, max(sample_datos$Departure.Arrival.time.convenient, na.rm = TRUE)), 
     ylim = c(0, 0.04), 
     col = "red", 
     border = "black")

# Histograma para los clientes insatisfechos
hist(departure_arrival_insatisfecho, 
     probability = TRUE, 
     main = "Insatisfechos", 
     xlab = "Departure arrival time convenient", 
     xlim = c(0, max(sample_datos$Departure.Arrival.time.convenient, na.rm = TRUE)), 
     ylim = c(0, 0.04), 
     col = "blue", 
     border = "black")
```

```{r, echo=FALSE}
par(mfrow = c(1, 2), mar = c(5, 5, 4, 2), cex = 1.2)

# Filtrar los datos por nivel de satisfacción
gate_satisfecho <- sample_datos$Gate.location[sample_datos$satisfaction == 1]
gate_insatisfecho <- sample_datos$Gate.location[sample_datos$satisfaction == 0]

hist(gate_satisfecho, 
     probability = TRUE, 
     main = "Satisfechos", 
     xlab = "Gate location", 
     xlim = c(0, max(sample_datos$Departure.Arrival.time.convenient, na.rm = TRUE)), 
     ylim = c(0, 0.04), 
     col = "red", 
     border = "black")

# Histograma para los clientes insatisfechos
hist(gate_insatisfecho, 
     probability = TRUE, 
     main = "Insatisfechos", 
     xlab = "Gate location", 
     xlim = c(0, max(sample_datos$Departure.Arrival.time.convenient, na.rm = TRUE)), 
     ylim = c(0, 0.04), 
     col = "blue", 
     border = "black")
```
Al graficar estas 4 variables, podemos ver que la ditribución entre pasajeros satisfechos e insatisfechos es muy similar por lo que concluimos que no impactan en lo que queremos predecir.

```{r, echo=FALSE}
library(ggplot2)
ggplot(data = sample_datos) +
  geom_histogram(mapping = aes(x = satisfaction, fill = Type.of.Travel),
                 colour = "black", binwidth = 0.5) +
  scale_fill_viridis_d() +
  facet_wrap(~ Type.of.Travel)
```

*3. Construcción de un árbol de decisión básico*

```{r}
entrenamiento <- sample_datos[1:35000,]
validacion <- sample_datos[35001:42500,]
testeo <- sample_datos[42501:50000,]

nrow(entrenamiento)
nrow(validacion)
nrow(testeo)
```

```{r}
library(rpart)
```

```{r}
tree <- rpart(formula = satisfaction ~ Flight.Distance + Inflight.wifi.service + Ease.of.Online.booking + Food.and.drink + Online.boarding + Seat.comfort + Inflight.entertainment + On.board.service + Leg.room.service + Baggage.handling + Checkin.service + Inflight.service + Cleanliness, 
              data = entrenamiento, 
              method = "class")
tree$control
```

```{r}
library(rpart.plot)
rpart.plot(tree)
```

*4. Evaluación del árbol de decisión básico*

```{r}
predictions <- predict(tree, newdata = testeo, type = "class")
predictions
```

```{r}
#install.packages("caret")
#install.packages("recipes")
#library(recipes)
#library(caret)

#matriz_confusion <- confusionMatrix(predictions, testeo$satisfaction)
```
